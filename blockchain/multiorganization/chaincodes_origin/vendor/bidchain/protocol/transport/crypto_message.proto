syntax = "proto3";

option go_package = "transport";
option java_package="cn.bidsun.metadata.common.protodao";

// 密文信息
message CryptoMessage {
    // 平台id
    string platformId = 1;
    // 加密前hash
    bytes hashBeforeEncrypt = 3;
    // 加密方法
    int32 cryptMethod = 4;
    // 加密信封信息
    bytes cryptoEnvelopeMsg = 5;
    // 数据类型(文件或者密文信息)
    CryptoDataType dataType = 6;
    // 密文信息(如果是文件则是文件hash)
    bytes msgData = 7;
    // 用户不用上传，智能合约计算生成
    string msgId = 8;
}

// 副本加密字段信息
message EncryptedMirrorData {
    // 摘要信息
    message summaryInfoPair {
        string key = 1;
        bytes hash = 2;
    }
    CryptoMessage msg = 1; // 加密信息
    // 字段名称 对应的值的hash值
    repeated summaryInfoPair summaryInfoList = 2; // 概要信息
    // 是否强制重写
    bool forceOverwriteCryptoMessage = 3;
}

message AddCryptoMessageRequest {
    message msgInfo {
        // 是否强行修改数据(防止用户忘记秘钥 丢失数据)
        bool forceOverWrite = 1;
        CryptoMessage msg = 2;
    }
    repeated msgInfo infos = 1;
}

message AddCryptoMessageResponse {
    repeated string msgIds = 1;
}


message GetCryptoMessageRequest {
    repeated string msgIds = 1;
}

message GetCryptoMessageResponse {
    message info {
        string msgId = 1;
        CryptoMessage msg = 2;
    }
    repeated info responses = 1;
}

//// 根据messageId查询对应的历史信息
//message GetCryptoMessageHistoryRequest {
//    repeated string msgIds = 1;
//}
//
//message GetCryptoMessageHistoryResponse {
//    message info {
//        string msgId = 1;
//        repeated CryptoMessage msgList = 2;
//    }
//    repeated info infoList = 1;
//}


// 密文类型
enum CryptoDataType {
    CRYPTO_MESSAGE = 0;
    FILE = 1;
}